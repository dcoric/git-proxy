services:
  git-proxy:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: git-proxy
    ports:
      - '8080:8080'
      - '2222:2222'
    volumes:
      # Mount Docker-specific config file (generated by docker-setup.sh)
      # This keeps the original proxy.config.json unchanged for source control
      - ./proxy.config.docker.json:/app/proxy.config.json:ro
      # Persistent data storage
      - git-proxy-data:/app/data
      # TLS certificates (if using HTTPS)
      - ./certs:/app/certs:ro
      # SSH keys (if using SSH)
      - ./.ssh:/app/.ssh:ro
    environment:
      - NODE_ENV=production
      - PORT=8080
    restart: unless-stopped
    networks:
      - git-proxy-network
    # Uncomment if using MongoDB
    # depends_on:
    #   - mongodb

  # Uncomment to add MongoDB service
  # mongodb:
  #   image: mongo:7
  #   container_name: git-proxy-mongodb
  #   ports:
  #     - "27017:27017"
  #   volumes:
  #     - mongodb-data:/data/db
  #   environment:
  #     - MONGO_INITDB_ROOT_USERNAME=admin
  #     - MONGO_INITDB_ROOT_PASSWORD=changeme
  #   restart: unless-stopped
  #   networks:
  #     - git-proxy-network

volumes:
  git-proxy-data:
  # mongodb-data:

networks:
  git-proxy-network:
    driver: bridge
